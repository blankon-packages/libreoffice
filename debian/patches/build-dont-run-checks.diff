From 4fb35cfbf4b10d5644fd636ddfe3e07b5a932d45 Mon Sep 17 00:00:00 2001
From: Bjoern Michaelsen <bjoern.michaelsen@canonical.com>
Date: Sun, 24 Jun 2012 14:01:54 +0200
Subject: [PATCH] dont run check targets in build, to allow running them
 separately later

Change-Id: Idb46ebcb427522c74632a1813afcbb841fb61243
---
 Makefile.top            |   10 ++++++++--
 solenv/bin/build.pl     |    2 +-
 solenv/gbuild/Module.mk |    2 +-
 3 files changed, 10 insertions(+), 4 deletions(-)

diff --git a/Makefile.top b/Makefile.top
index 7362bbc..ae849fb 100644
--- a/Makefile.top
+++ b/Makefile.top
@@ -40,7 +40,7 @@ include $(WORKDIR)/modules.mk
 include $(SRCDIR)/solenv/gbuild/Output.mk
 $(if $(filter $(gbuild_modules),$(dmake_modules)),$(eval $(call gb_Output_warn,The following modules claim to be both dmake and gbuild: $(filter $(gbuild_modules),$(dmake_modules)))))
 
-export gb_TAILBUILDTARGET=all slowcheck
+export gb_TAILBUILDTARGET=all
 
 define gbuild_module_rules
 .PHONY: $(1) $(1).all $(1).build $(1).check $(1).clean $(1).subsequentcheck $(1).deliver
@@ -374,7 +374,7 @@ findunusedcode:
               | grep -v ^WSObject \
               > unusedcode.easy
 
-check: dev-install subsequentcheck
+check: unitcheck slowcheck dev-install subsequentcheck
 
 subsequentcheck :| $(if $(filter-out subsequentcheck,$(MAKECMDGOALS)),dev-install)
 	$(GNUMAKE) -j $(CHECK_PARALLELISM) $(GMAKE_OPTIONS) -f Makefile.post $@
diff --git a/solenv/bin/build.pl b/solenv/bin/build.pl
index 74d0f32..daa4ae0 100755
--- a/solenv/bin/build.pl
+++ b/solenv/bin/build.pl
@@ -1895,7 +1895,7 @@ sub run_job {
         {
             return 1 if (! $path =~ /prj$/ );
             my $gbuild_flags = '-j' . $ENV{PARALLELISM};
-            my $gbuild_target = 'all slowcheck';
+            my $gbuild_target = 'all';
             if ($registered_name =~ /tail_build\/prj$/ )
             {
                 $gbuild_target = $ENV{gb_TAILBUILDTARGET};
diff --git a/solenv/gbuild/Module.mk b/solenv/gbuild/Module.mk
index e5f87f0..9c2608c 100644
--- a/solenv/gbuild/Module.mk
+++ b/solenv/gbuild/Module.mk
@@ -129,7 +129,7 @@ gb_Module_DEVINSTALLHINT=
 debugrun :| build
 endif
 
-all : build unitcheck
+all : build
 	$(info $(gb_Module_BUILDHINT))
 
 build : 
-- 
1.7.9.5

--- a/Makefile-old	2012-10-28 16:25:49.016468687 +0100
+++ b/Makefile	2012-10-28 16:25:59.440520356 +0100
@@ -9,7 +9,7 @@
 
 # must not be empty so we can have a target for it
 ifeq ($(MAKECMDGOALS),)
-MAKECMDGOALS:=all
+MAKECMDGOALS:=build
 endif
 
 SHELL=/usr/bin/env bash
